if (NOT EOSIO_WASM_OLD_BEHAVIOR STREQUAL "On")

  macro(add_contract CONTRACT_NAME TARGET)
    add_executable( ${TARGET} ${ARGN} )
    get_target_property(BINOUTPUT ${TARGET} BINARY_DIR)
    target_link_libraries(${TARGET} PRIVATE eosio_dsm eosio)
  endmacro()
  macro (target_ricardian_directory TARGET DIR)
    target_compile_options( ${TARGET} PUBLIC -R${DIR} )
    file(GLOB contracts ${DIR}/*.contracts.md ${DIR}/*.clauses.md)
    add_dependencies( ${TARGET} ${contracts} )
  endmacro()

else()

  macro(add_contract CONTRACT_NAME TARGET)
    add_executable( ${TARGET}.wasm ${ARGN} )
    set_target_properties(${TARGET}.wasm PROPERTIES SUFFIX "")
    get_target_property(BINOUTPUT ${TARGET}.wasm BINARY_DIR)
    target_link_libraries(${TARGET}.wasm PRIVATE eosio_dsm eosio)
  endmacro()
  macro (target_ricardian_directory TARGET DIR)
    target_compile_options( ${TARGET}.wasm PUBLIC -R${DIR} )
    file(GLOB contracts ${DIR}/*.contracts.md ${DIR}/*.clauses.md)
    add_dependencies( ${TARGET}.wasm ${contracts} )
  endmacro()

endif()