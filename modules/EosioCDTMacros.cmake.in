if (NOT EOSIO_WASM_OLD_BEHAVIOR STREQUAL "On")

  macro(add_contract CONTRACT_NAME TARGET)
    add_executable( ${TARGET} ${ARGN} )
    get_target_property(BINOUTPUT ${TARGET} BINARY_DIR)
    target_compile_definitions( ${TARGET} PUBLIC EOSIO_CONTRACT=${CONTRACT_NAME} )
    target_link_libraries(${TARGET} PRIVATE eosio)
  endmacro()
  macro (target_ricardian_directory TARGET DIR)
    target_compile_options( ${TARGET} PUBLIC -R${DIR} )
    file(GLOB contracts ${DIR}/*.contracts.md ${DIR}/*.clauses.md)
    add_dependencies( ${TARGET} ${contracts} )
  endmacro()

else()

  macro(add_contract CONTRACT_NAME TARGET)
    add_executable( ${TARGET}.wasm ${ARGN} )
    get_target_property(BINOUTPUT ${TARGET}.wasm BINARY_DIR)
    target_compile_definitions( ${TARGET}.wasm PUBLIC EOSIO_CONTRACT=${CONTRACT_NAME} )
    target_link_libraries(${TARGET}.wasm PRIVATE eosio)
  endmacro()
  macro (target_ricardian_directory TARGET DIR)
    target_compile_options( ${TARGET}.wasm PUBLIC -R${DIR} )
    file(GLOB contracts ${DIR}/*.contracts.md ${DIR}/*.clauses.md)
    add_dependencies( ${TARGET}.wasm ${contracts} )
  endmacro()

endif()